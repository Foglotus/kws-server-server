server:
  host: "0.0.0.0"
  port: 11123
  max_connections: 1000
  read_timeout: 1200  # 读取超时（秒）- 20分钟，支持大文件上传
  write_timeout: 1200 # 写入超时（秒）- 20分钟，支持长时间处理

# 实时语音识别配置（Streaming ASR）
streaming_asr:
  enabled: true
  model_type: "zipformer" # zipformer, paraformer, etc.
  models_dir: "/models/streaming/sherpa-onnx-streaming-zipformer-bilingual-zh-en-2023-02-20"
  # Transducer 模型配置
  encoder: "encoder-epoch-99-avg-1.onnx"
  decoder: "decoder-epoch-99-avg-1.onnx"
  joiner: "joiner-epoch-99-avg-1.onnx"
  tokens: "tokens.txt"
  # 推理配置
  num_threads: 6
  sample_rate: 16000
  feature_dim: 80
  # 端点检测配置
  enable_endpoint: true
  rule1_min_trailing_silence: 2.4
  rule2_min_trailing_silence: 1.2
  rule3_min_utterance_length: 20

# 离线语音识别配置（Non-streaming ASR）
offline_asr:
  enabled: true
  model_type: "paraformer" # whisper, paraformer, etc.
  models_dir: "/models/offline/sherpa-onnx-paraformer-zh-2024-03-09"
  # Paraformer 模型配置
  encoder: "model.int8.onnx"
  decoder: "decoder.onnx"
  tokens: "tokens.txt"
  # 推理配置
  num_threads: 6
  sample_rate: 16000
  decoding_method: "greedy_search"
  max_active_paths: 4
  # 文件处理配置
  max_file_size_mb: 1000   # 最大允许上传的文件大小（MB），支持超大文件
  chunk_duration_sec: 60   # 分块处理时长（秒），建议30-60秒以提高处理效率
  max_concurrency: 4       # 最大并发处理块数，增加到4以加快处理速度
  max_processing_timeout_min: 120  # 最大处理超时时间（分钟），默认120分钟，适合处理超长音频

# 说话者分离配置（Speaker Diarization）
speaker_diarization:
  enabled: true
  models_dir: "/models/diarization"
  # 分割模型
  segmentation_model: "sherpa-onnx-pyannote-segmentation-3-0/model.onnx"
  # 说话者嵌入模型
  embedding_model: "3dspeaker_speech_eres2net_base_sv_zh-cn_3dspeaker_16k.onnx"
  # 聚类配置
  clustering:
    # 如果知道说话者数量，设置此项
    num_clusters: 0
    # 如果不知道说话者数量，使用阈值（提高阈值以减少说话者过度分割）
    # 范围: 0.0-1.0，值越高，越倾向于认为是同一个人
    # 0.5: 容易过度分割，产生过多说话者
    # 0.85: 平衡值
    # 0.95: 更严格，适合对话人数较少的场景
    threshold: 0.90
    # 最大说话者数量限制（防止异常情况）
    max_speakers: 4
  num_threads: 6

# VAD（语音活动检测）配置
vad:
  enabled: true
  model: "/models/vad/silero_vad.onnx"
  sample_rate: 16000
  min_silence_duration: 500 # ms
  min_speech_duration: 250 # ms
  threshold: 0.5
  window_size: 512
  num_threads: 6

# 标点符号配置（Punctuation）
punctuation:
  enabled: true
  model_dir: "/models/punctuation"
  model: "sherpa-onnx-punct-ct-transformer-zh-en-vocab272727-2024-04-12/model.onnx"
  num_threads: 6

# 并发控制
concurrency:
  max_streaming_sessions: 100      # 最大实时会话数
  max_offline_jobs: 50              # 最大离线任务数（已废弃，由worker_pool_size控制）
  worker_pool_size: 2               # 任务队列worker数量，控制并发处理的任务数（默认2，避免资源占用过高）
  queue_size: 100                   # 任务队列大小，超过2分钟的音频将进入队列等待处理

# 日志配置
logging:
  level: "info" # debug, info, warn, error
  file: "/logs/airecorder.log"
  max_size: 100 # MB
  max_backups: 5
  max_age: 30 # days
